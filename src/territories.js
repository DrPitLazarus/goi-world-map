import Konva from 'konva';
import vars, { factions } from './vars';
import { layer, eventBus } from './index';
import loadResources from './load_resources';

const { scale } = vars;

export default function initTerritories(group, writeMessage) {
    for (let node in data) {
        let nodeLine = new Konva.Line({
            points: data[node].boundaries.map(val => val * scale),
            fill: factions[data[node].faction].color,
            closed: true,
            opacity: 0.5
        });
        let nodeCaptiol = new Konva.Circle({
            x: data[node].capitol[0] * scale,
            y: data[node].capitol[1] * scale, 
            radius: 6,
            fill: 'white'
        });
        let nodeResourcesGroup = new Konva.Group({
            x: data[node].capitol[0] * scale,
            y: data[node].capitol[1] * scale - 25,
            visible: false
        });
        let nodeResourcesCircle = new Konva.Circle({
            fill: 'orange',
            radius: 16
        });
        let nodeResourcesTextRect = new Konva.Rect({
            fill: '#1b1b13',
            width: 40,
            height: 24,
            offsetY: 12,
            cornerRadius: 10
        });
        let nodeResourcesText = new Konva.Text({
            text: data[node].resourceValue,
            fill: 'white',
            fontSize: 16,
            x: 20,
            y: -8
        });
        let nodeResourcesImage = new Image();
        nodeResourcesImage.onload = function() {
            let img = new Konva.Image({
                image: nodeResourcesImage,
                width: 24,
                height: 24,
                offsetX: 12,
                offsetY: 12
            });
            nodeResourcesGroup.add(img);
        }
        nodeResourcesImage.src = loadResources[data[node].resource];
        group.add(nodeLine);
        group.add(nodeCaptiol);
        nodeResourcesGroup.add(nodeResourcesCircle);
        nodeResourcesGroup.add(nodeResourcesTextRect);
        nodeResourcesGroup.add(nodeResourcesText)
        nodeResourcesTextRect.moveToBottom();
        group.add(nodeResourcesGroup);
        eventBus.addEventListener("viewSelectChange", e => {
            nodeResourcesGroup.visible(e.target == 'resources' ? true : false);
            layer.draw();
        });
        if (data[node].contested) {
            let { attacker, attackerGoal, attackerProgress, defender, defenderGoal, defenderProgress } = data[node].contested;
            let nodeBattle = new Konva.Group({
                x: data[node].capitol[0],
                y: data[node].capitol[1],
                offsetX: 30,
                offsetY: 75
            });
            let nodeBattleBase = new Konva.Line({
                points: [0, 0, 60, 0, 60, 50, 30, 70, 0, 50],
                fill: 'black',
                closed: true
            });
            let nodeBattleAttacker = new Konva.Rect({
                x: 5,
                y: 5,
                width: 50 * (attackerProgress / attackerGoal),
                height: 6,
                fill: factions[attacker].color
            });
            let nodeBattleDefender = new Konva.Rect({
                x: 5,
                y: 13,
                width: 50 * (defenderProgress / defenderGoal),
                height: 6,
                fill: factions[defender].color
            });
            nodeBattle.add(nodeBattleBase);
            nodeBattle.add(nodeBattleAttacker);
            nodeBattle.add(nodeBattleDefender); 
            group.add(nodeBattle);
            eventBus.addEventListener("viewSelectChange", e => {
                nodeBattle.visible(e.target == 'battles' ? true : false);
                layer.draw();
            });
        }
        nodeLine.on('mouseover', function () {
            let msg = data[node].name;
            if (data[node].contested) {
                let { attacker, attackerGoal, attackerProgress, defender, defenderGoal, defenderProgress } = data[node].contested;
                msg += `\n
Attacker: ${attacker}\r
Progress: ${attackerProgress}/${attackerGoal}(${Math.round(attackerProgress / attackerGoal * 100)}%)\n
Defender: ${defender}\r
Progress: ${defenderProgress}/${defenderGoal}(${Math.round(defenderProgress / defenderGoal * 100)}%)
`
            }
            writeMessage(msg);
        });
    }
}

export const data = {
    tamblair: {
        boundaries: [283, 415, 272, 412, 266, 414, 261, 409, 255, 408, 239, 398, 231, 395, 220, 403, 209, 413, 204, 419, 196, 423, 188, 428, 183, 435, 183, 442, 180, 449, 180, 458, 181, 465, 186, 471, 183, 478, 185, 488, 187, 499, 190, 509, 195, 517, 202, 511, 210, 508, 219, 515, 229, 518, 237, 528, 238, 541, 233, 548, 224, 553, 219, 557, 214, 561, 213, 566, 208, 568, 206, 575, 206, 583, 211, 589, 211, 606, 218, 611, 224, 611, 229, 609, 237, 615, 245, 618, 254, 613, 261, 618, 264, 615, 274, 613, 283, 613, 287, 604, 294, 603, 295, 599, 290, 592, 295, 587, 294, 580, 298, 574, 292, 567, 288, 568, 281, 564, 282, 560, 282, 557, 289, 560, 291, 558, 291, 553, 293, 549, 288, 544, 285, 542, 281, 539, 282, 534, 287, 530, 292, 526, 289, 523, 284, 522, 288, 515, 284, 506, 275, 504, 267, 503, 263, 493, 265, 482, 267, 470, 266, 461, 265, 456, 269, 452, 276, 440, 280, 431, 285, 426, 286, 422],
        capitol: [235, 565],
        faction: 'anglea',
        name: 'Tamblair',
        resource: 'medicine',
        resourceValue: 4
    },
    kinforth: {
        boundaries: [284, 415, 287, 408, 297, 403, 308, 400, 319, 398, 327, 401, 337, 399, 341, 394, 358, 391, 370, 393, 377, 394, 385, 401, 394, 401, 397, 396, 407, 396, 412, 394, 429, 396, 439, 401, 446, 409, 451, 419, 456, 424, 451, 429, 453, 439, 457, 447, 461, 457, 469, 463, 473, 472, 468, 476, 467, 483, 466, 491, 463, 499, 454, 502, 446, 505, 436, 506, 431, 509, 422, 503, 410, 508, 388, 509, 378, 505, 370, 503, 366, 499, 362, 504, 353, 496, 347, 496, 341, 503, 338, 508, 331, 509, 326, 513, 317, 513, 314, 511, 310, 510, 306, 508, 300, 508, 294, 510, 286, 503, 283, 505, 273, 505, 266, 500, 263, 491, 267, 476, 268, 467, 266, 458, 269, 451, 280, 432, 285, 426],
        capitol: [317, 476],
        faction: 'anglea',
        name: 'Kinforth',
        resource: 'medicine',
        resourceValue: 1
    },
    oaxley: {
        boundaries: [317, 513, 325, 514, 331, 510, 338, 509, 342, 503, 347, 498, 350, 497, 360, 504, 363, 503, 365, 499, 373, 503, 381, 505, 388, 510, 400, 508, 409, 507, 418, 504, 426, 506, 433, 514, 441, 519, 448, 529, 452, 540, 459, 547, 457, 550, 450, 544, 446, 545, 442, 548, 439, 551, 436, 550, 435, 546, 436, 541, 433, 540, 427, 540, 422, 543, 420, 549, 418, 549, 417, 543, 412, 539, 407, 541, 404, 544, 402, 547, 398, 548, 393, 545, 390, 545, 385, 541, 379, 539, 373, 540, 370, 543, 365, 539, 362, 540, 357, 539, 357, 535, 354, 533, 356, 530, 357, 527, 355, 524, 352, 526, 349, 523, 348, 528, 350, 536, 353, 542, 350, 545, 347, 548, 344, 547, 341, 549, 339, 549, 336, 545, 335, 540, 333, 536, 329, 531, 330, 527, 326, 527, 325, 521, 323, 519, 322, 521, 319, 527, 317, 524, 316, 521],
        capitol: [348, 541],
        faction: 'anglea',
        name: 'Oaxley',
        resource: 'medicine',
        resourceValue: 3
    },
    utentana: {
        boundaries: [455, 422, 451, 428, 452, 441, 459, 449, 461, 458, 467, 462, 473, 465, 475, 472, 470, 474, 466, 481, 469, 488, 462, 499, 457, 503, 449, 503, 444, 505, 432, 508, 432, 515, 441, 519, 447, 526, 452, 541, 458, 545, 459, 551, 463, 550, 463, 559, 469, 563, 475, 562, 474, 555, 480, 558, 490, 556, 494, 560, 497, 566, 495, 571, 500, 576, 507, 570, 513, 568, 519, 569, 522, 563, 521, 556, 524, 551, 525, 547, 523, 542, 533, 538, 536, 543, 539, 541, 550, 546, 553, 536, 557, 536, 559, 526, 558, 519, 549, 516, 545, 514, 552, 509, 548, 504, 537, 501, 530, 497, 523, 497, 524, 491, 531, 484, 528, 473, 525, 465, 523, 457, 518, 444, 511, 438, 513, 433, 505, 426, 493, 426, 488, 434, 483, 435, 484, 442, 473, 439, 471, 433, 460, 429],
        capitol: [549, 535],
        faction: 'anglea',
        name: 'Utentana',
        resource: 'lumber',
        resourceValue: 4
    },
    cusichaca: {
        boundaries: [267, 657, 262, 665, 261, 673, 255, 679, 251, 689, 254, 697, 259, 698, 263, 703, 264, 709, 271, 712, 271, 722, 276, 722, 279, 728, 276, 734, 281, 737, 281, 742, 289, 745, 291, 751, 298, 757, 306, 756, 311, 758, 311, 765, 317, 769, 326, 772, 319, 776, 316, 779, 310, 783, 302, 783, 302, 788, 307, 792, 303, 797, 299, 803, 300, 813, 305, 818, 305, 825, 312, 828, 316, 834, 309, 844, 308, 843, 302, 835, 295, 837, 285, 831, 281, 833, 276, 831, 266, 840, 256, 843, 249, 845, 239, 842, 229, 843, 219, 847, 215, 840, 211, 834, 212, 826, 209, 822, 209, 811, 214, 807, 210, 802, 206, 798, 196, 798, 191, 800, 184, 798, 176, 799, 169, 796, 164, 792, 163, 785, 159, 776, 163, 771, 164, 763, 160, 758, 161, 749, 162, 739, 161, 733, 161, 725, 162, 720, 159, 712, 157, 703, 162, 696, 168, 694, 174, 693, 180, 690, 186, 694, 197, 688, 197, 680, 206, 674, 210, 678, 215, 676, 219, 672, 224, 669, 228, 663, 230, 659, 229, 655, 237, 654, 241, 652, 247, 655, 255, 653, 263, 652],
        capitol: [235, 671],
        faction: 'anglea',
        name: 'Cusichaca',
        resource: 'mine',
        resourceValue: 3
    },
    hongshiCoast: {
        boundaries: [325, 771, 330, 772, 333, 773, 339, 771, 343, 775, 349, 772, 358, 773, 364, 774, 374, 771, 382, 765, 386, 767, 397, 770, 405, 771, 400, 766, 404, 763, 400, 759, 408, 759, 410, 764, 416, 761, 425, 767, 439, 772, 460, 776, 468, 780, 479, 777, 488, 779, 494, 773, 499, 774, 503, 772, 507, 773, 509, 769, 516, 770, 522, 768, 515, 762, 526, 768, 528, 779, 529, 787, 530, 795, 528, 804, 534, 806, 540, 813, 536, 819, 528, 825, 514, 826, 504, 829, 495, 837, 486, 845, 471, 851, 449, 852, 446, 849, 439, 850, 437, 847, 429, 847, 407, 839, 396, 835, 371, 835, 363, 837, 353, 842, 343, 847, 332, 852, 322, 851, 311, 843, 314, 835, 314, 828, 307, 827, 306, 821, 306, 817, 300, 813, 299, 805, 301, 799, 306, 795, 306, 790, 301, 785, 304, 782, 310, 782, 314, 781, 317, 777, 321, 775],
        capitol: [419, 777],
        contested: {
            attacker: "yesha",
            attackerProgress: 17000,
            attackerGoal: 282000,
            defender: "anglea",
            defenderProgress: 234000,
            defenderGoal: 372000
        },
        faction: 'anglea',
        name: 'Hongshi Coast',
        resource: 'medicine',
        resourceValue: 4
    },
    yunin: {
        boundaries: [516, 763, 519, 761, 519, 758, 521, 755, 525, 758, 528, 758, 530, 755, 530, 748, 527, 745, 525, 741, 527, 735, 530, 731, 531, 725, 531, 720, 534, 715, 538, 716, 542, 720, 544, 722, 549, 724, 549, 728, 553, 731, 556, 735, 560, 737, 567, 740, 571, 745, 576, 745, 581, 743, 586, 740, 590, 738, 599, 737, 606, 738, 611, 735, 613, 732, 617, 734, 618, 738, 617, 743, 617, 746, 619, 748, 621, 751, 619, 755, 618, 757, 618, 761, 616, 765, 614, 771, 613, 776, 614, 781, 619, 784, 624, 789, 626, 794, 624, 799, 628, 802, 632, 801, 636, 804, 639, 808, 648, 810, 653, 814, 658, 813, 664, 815, 666, 818, 663, 822, 658, 826, 657, 829, 657, 834, 655, 838, 652, 841, 656, 844, 656, 848, 659, 848, 662, 852, 666, 850, 670, 847, 675, 848, 675, 853, 674, 856, 679, 855, 683, 858, 683, 863, 679, 866, 678, 871, 673, 869, 668, 865, 666, 863, 660, 865, 656, 866, 654, 869, 650, 869, 646, 870, 644, 873, 642, 878, 641, 882, 638, 887, 633, 885, 628, 883, 623, 883, 617, 876, 615, 872, 606, 865, 595, 866, 590, 865, 588, 861, 589, 857, 582, 854, 574, 852, 566, 847, 555, 842, 548, 842, 542, 844, 538, 845, 530, 845, 522, 841, 518, 834, 515, 828, 524, 825, 528, 825, 536, 820, 539, 815, 539, 810, 536, 807, 529, 806, 529, 801, 530, 795, 529, 791, 528, 785, 528, 780, 527, 771, 527, 768, 521, 766],
        capitol: [588, 810],
        faction: 'anglea',
        name: 'Yunin',
        resource: 'farm',
        resourceValue: 2
    },
    paritus: {
        boundaries: [613, 732, 614, 727, 612, 723, 611, 717, 606, 710, 599, 704, 590, 698, 586, 692, 582, 681, 580, 675, 579, 669, 582, 663, 583, 659, 579, 659, 583, 655, 587, 653, 593, 653, 598, 651, 602, 649, 610, 648, 617, 653, 621, 653, 629, 648, 634, 645, 641, 645, 649, 646, 655, 652, 661, 654, 666, 653, 672, 654, 676, 656, 681, 651, 693, 646, 698, 651, 702, 654, 703, 659, 710, 665, 713, 667, 718, 671, 721, 675, 729, 677, 736, 683, 741, 685, 755, 684, 766, 684, 775, 690, 775, 696, 770, 703, 773, 711, 777, 715, 774, 727, 774, 734, 774, 739, 779, 740, 786, 744, 786, 750, 791, 756, 795, 757, 799, 764, 800, 768, 803, 772, 809, 776, 810, 781, 810, 785, 813, 788, 813, 793, 811, 796, 812, 802, 811, 806, 806, 809, 805, 813, 802, 810, 798, 809, 798, 804, 795, 801, 791, 801, 786, 803, 777, 800, 770, 802, 764, 807, 754, 807, 743, 803, 738, 803, 725, 814, 720, 814, 715, 812, 710, 813, 706, 815, 700, 812, 695, 809, 691, 806, 685, 806, 675, 810, 668, 816, 662, 814, 654, 813, 646, 809, 641, 808, 637, 806, 633, 802, 628, 802, 624, 799, 625, 794, 624, 788, 619, 784, 614, 781, 612, 776, 614, 768, 617, 762, 619, 755, 620, 749, 617, 743, 618, 738, 618, 734],
        capitol: [677, 712],
        faction: 'baron',
        name: 'Paritus',
        resource: 'lumber',
        resourceValue: 4
    },
    hanat: {
        boundaries: [580, 658, 576, 659, 571, 657, 568, 657, 556, 657, 550, 655, 542, 651, 538, 649, 536, 646, 537, 641, 534, 638, 529, 634, 529, 631, 530, 628, 533, 628, 536, 630, 541, 632, 545, 634, 555, 635, 554, 631, 553, 628, 554, 625, 556, 622, 561, 623, 563, 623, 563, 620, 567, 619, 570, 619, 575, 621, 581, 626, 583, 626, 584, 622, 587, 619, 592, 617, 594, 614, 594, 609, 590, 607, 586, 607, 584, 608, 583, 606, 584, 602, 581, 599, 579, 596, 579, 592, 581, 588, 585, 586, 589, 584, 593, 583, 597, 579, 602, 579, 604, 578, 612, 578, 615, 576, 618, 574, 622, 577, 623, 580, 622, 584, 620, 588, 620, 590, 627, 591, 632, 591, 636, 586, 637, 586, 640, 588, 641, 590, 644, 592, 649, 592, 653, 587, 659, 583, 663, 579, 667, 577, 672, 577, 675, 573, 679, 573, 686, 575, 693, 577, 698, 578, 698, 582, 702, 585, 702, 592, 706, 594, 713, 600, 716, 600, 723, 606, 733, 607, 741, 610, 748, 614, 749, 618, 753, 626, 764, 627, 770, 627, 774, 624, 787, 624, 791, 627, 794, 634, 798, 637, 800, 637, 803, 639, 807, 639, 808, 636, 811, 633, 816, 633, 818, 637, 817, 640, 815, 644, 819, 647, 823, 650, 827, 651, 829, 647, 832, 646, 835, 642, 839, 643, 840, 647, 846, 650, 849, 654, 854, 657, 853, 660, 847, 662, 841, 666, 837, 670, 833, 675, 829, 680, 827, 683, 821, 684, 811, 688, 804, 688, 799, 689, 793, 691, 787, 695, 782, 698, 777, 697, 775, 696, 775, 690, 771, 686, 765, 684, 759, 683, 753, 683, 744, 684, 737, 683, 731, 680, 724, 676, 719, 672, 714, 667, 713, 665, 709, 664, 706, 662, 705, 661, 701, 654, 695, 646, 690, 646, 681, 650, 677, 655, 673, 655, 669, 653, 664, 653, 659, 654, 655, 652, 651, 648, 648, 647, 645, 645, 633, 645, 626, 650, 622, 652, 617, 653, 612, 648, 608, 650, 601, 649, 595, 653, 588, 653],
        capitol: [611, 588],
        faction: 'baron',
        name: 'Hanat',
        resource: 'oil',
        resourceValue: 3
    }
}
